@model HammerDrop_Auction_app.Entities.Ad

@{
    ViewData["Title"] = "Create Ad";
}

<div class="container mt-4">
    <div class="card shadow-sm rounded p-4">
        <h4 class="card-title mb-3">Post Your Ad</h4>
        <hr />

        <form asp-action="Create" enctype="multipart/form-data">
            <div asp-validation-summary="ModelOnly" class="text-danger mb-3"></div>

            <!-- Product Details -->
            <h5 class="mb-3">Product Details</h5>
            <div class="form-group mb-3">
                <label>Subcategory</label>
                <input type="text" class="form-control" value="@ViewBag.SubcategoryTitle" readonly />
                <input type="hidden" name="SubcategoryId" value="@ViewBag.SubcategoryId" />
            </div>

            <div class="form-group mb-3">
                <label asp-for="Title"></label>
                <input asp-for="Title" class="form-control" placeholder="Enter product title" />
                <span asp-validation-for="Title" class="text-danger"></span>
            </div>

            <div class="form-group mb-3">
                <label asp-for="Description"></label>
                <textarea asp-for="Description" class="form-control" rows="4" placeholder="Describe your product in detail"></textarea>
                <span asp-validation-for="Description" class="text-danger"></span>
            </div>

            <div class="form-group mb-3">
                <label asp-for="BrandName"></label>
                <input asp-for="BrandName" class="form-control" placeholder="Enter brand name" />
                <span asp-validation-for="BrandName" class="text-danger"></span>
            </div>

            <!-- Location -->
            <h5 class="mb-3 mt-4">Location</h5>
            <div class="form-group mb-3">
                <label asp-for="CountryId"></label>
                <select asp-for="CountryId" class="form-control" asp-items="ViewBag.CountryId">
                    <option value="">-- Select Country --</option>
                </select>
            </div>

            <div class="form-group mb-3">
                <label asp-for="StateId"></label>
                <select asp-for="StateId" class="form-control" asp-items="ViewBag.StateId">
                    <option value="">-- Select State --</option>
                </select>
            </div>

            <div class="form-group mb-3">
                <label asp-for="CityId"></label>
                <select asp-for="CityId" class="form-control" asp-items="ViewBag.CityId">
                    <option value="">-- Select City --</option>
                </select>
            </div>

            <!-- Sale Type & Pricing -->
            <h5 class="mb-3 mt-4">Sale Type & Price</h5>
            <div class="form-group mb-3">
                <label><strong>How do you want to sell this product?</strong></label><br />
                <div class="btn-group btn-group-toggle" data-toggle="buttons">
                    <label class="btn btn-outline-primary">
                        <input type="radio" name="SaleType" id="saleTypeAuction" value="auction"> Auction
                        <span class="badge bg-warning text-dark">Bidders compete</span>
                    </label>
                    <label class="btn btn-outline-primary">
                        <input type="radio" name="SaleType" id="saleTypeFixed" value="fixed"> Fixed Price
                        <span class="badge bg-success">Buy instantly</span>
                    </label>
                </div>
            </div>

            <div id="priceField" class="form-group mb-3" style="display:none;">
                <label asp-for="Price"></label>
                <input asp-for="Price" class="form-control" placeholder="Enter fixed price" />
                <span asp-validation-for="Price" class="text-danger"></span>
            </div>

            <div id="auctionFields" style="display:none;">
                <div class="form-group mb-3">
                    <label asp-for="BasePrice"></label>
                    <input asp-for="BasePrice" class="form-control" placeholder="Enter base price" />
                    <span asp-validation-for="BasePrice" class="text-danger"></span>
                </div>
                <div class="form-group mb-3">
                    <label asp-for="ReservedPrice"></label>
                    <input asp-for="ReservedPrice" class="form-control" placeholder="Enter reserved price (optional)" />
                    <span asp-validation-for="ReservedPrice" class="text-danger"></span>
                </div>
                <div class="form-group mb-3">
                    <label>Auction Duration</label>
                    <select name="AuctionDuration" class="form-control">
                        <option value="1">1 Day</option>
                        <option value="3">3 Days</option>
                        <option value="5">5 Days</option>
                        <option value="7">7 Days</option>
                    </select>
                </div>
            </div>

            <!-- User Info -->
            <h5 class="mb-3 mt-4">Your Details</h5>
            <div class="form-group mb-3">
                <label for="UserName">Posted By</label>
                <input type="text" id="UserName" name="UserName" value="@ViewBag.UserName" class="form-control" readonly />
            </div>

            <div class="form-group mb-3">
                <label asp-for="MobilePhoneNumber"></label>
                <input asp-for="MobilePhoneNumber" class="form-control" placeholder="Enter mobile number" />
                <span asp-validation-for="MobilePhoneNumber" class="text-danger"></span>
            </div>

            <div class="form-group form-check mb-3">
                <input class="form-check-input" asp-for="ShowPhoneNumberInAds" />
                <label class="form-check-label" asp-for="ShowPhoneNumberInAds"></label>
            </div>

            <!-- File Upload -->
            <div class="form-group mb-4">
                <label>Upload Images</label>
                <input type="file" name="uploadedImages" multiple class="form-control-file" id="uploadedImages" />
                <small class="form-text text-muted">Select multiple images at once.</small>
            </div>

            <!-- Submit Buttons -->
            <div class="form-group mb-3">
                <input type="submit" value="Create Ad" class="btn btn-primary btn-lg" />
                <a asp-action="Index" class="btn btn-outline-secondary btn-lg ml-2">Cancel</a>
            </div>
        </form>
    </div>
</div>




@section Scripts {
    @await Html.PartialAsync("_ValidationScriptsPartial")

    <script>
        $(document).ready(function () {
            // Location dropdown logic
            $('#CountryId').change(function () {
                var countryId = $(this).val();
                $('#StateId').empty().append('<option value="">-- Select State --</option>');
                $('#CityId').empty().append('<option value="">-- Select City --</option>');

                if (countryId) {
                    $.getJSON('/Ads/GetStatesByCountry?countryId=' + countryId, function (data) {
                        $.each(data, function (i, state) {
                            $('#StateId').append($('<option>', { value: state.id, text: state.name }));
                        });
                    });
                }
            });

            $('#StateId').change(function () {
                var stateId = $(this).val();
                $('#CityId').empty().append('<option value="">-- Select City --</option>');

                if (stateId) {
                    $.getJSON('/Ads/GetCitiesByState?stateId=' + stateId, function (data) {
                        $.each(data, function (i, city) {
                            $('#CityId').append($('<option>', { value: city.id, text: city.name }));
                        });
                    });
                }
            });

            // Sale type toggle
            $('input[name="SaleType"]').change(function () {
                if ($(this).val() === "auction") {
                    $('#auctionFields').slideDown();
                    $('#priceField').slideUp();

                    // Required for auction
                    $('#BasePrice, #ReservedPrice, #AuctionEndTime').attr('required', true);
                    $('#Price').removeAttr('required');
                } else if ($(this).val() === "fixed") {
                    $('#auctionFields').slideUp();
                    $('#priceField').slideDown();

                    // Required for fixed price
                    $('#Price').attr('required', true);
                    $('#BasePrice, #ReservedPrice, #AuctionEndTime').removeAttr('required');
                }
            });
        });
    </script>
}
